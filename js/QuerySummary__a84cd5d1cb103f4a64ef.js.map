{"version":3,"sources":["./src/ui/QuerySummary/QuerySummary.ts","./src/events/QuerySummaryEvents.ts","./sass/_QuerySummary.scss"],"names":[],"mappings":"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","file":"QuerySummary__a84cd5d1cb103f4a64ef.js","sourcesContent":["import { Component } from '../Base/Component';\nimport { ComponentOptions } from '../Base/ComponentOptions';\nimport { QueryEvents, IQuerySuccessEventArgs } from '../../events/QueryEvents';\nimport { IComponentBindings } from '../Base/ComponentBindings';\nimport { $$, Dom } from '../../utils/Dom';\nimport { Assert } from '../../misc/Assert';\nimport { l } from '../../strings/Strings';\nimport { analyticsActionCauseList, IAnalyticsNoMeta } from '../Analytics/AnalyticsActionListMeta';\nimport { Initialization } from '../Base/Initialization';\nimport { QueryStateModel } from '../../models/QueryStateModel';\nimport * as Globalize from 'globalize';\nimport { QuerySummaryEvents } from '../../events/QuerySummaryEvents';\nimport * as _ from 'underscore';\nimport { exportGlobally } from '../../GlobalExports';\n\nimport 'styling/_QuerySummary';\n\nexport interface IQuerySummaryOptions {\n  enableSearchTips?: boolean;\n  onlyDisplaySearchTips?: boolean;\n}\n\n/**\n * The QuerySummary component can display information about the currently displayed range of results (e.g., \"Results\n * 1-10 of 123\").\n *\n * If the query matches no item, the QuerySummary component can instead display tips to help the end user formulate\n * a better query.\n */\nexport class QuerySummary extends Component {\n  static ID = 'QuerySummary';\n\n  static doExport = () => {\n    exportGlobally({\n      QuerySummary: QuerySummary\n    });\n  };\n\n  /**\n   * Options for the component\n   * @componentOptions\n   */\n  static options: IQuerySummaryOptions = {\n    /**\n     * Specifies whether to display the search tips to the end user when there are no search results.\n     *\n     * Default value is `true`.\n     */\n    enableSearchTips: ComponentOptions.buildBooleanOption({ defaultValue: true }),\n\n    /**\n     * Specifies whether to hide the information about the currently displayed range of results and only display the\n     * search tips instead.\n     *\n     * Default value is `false`.\n     */\n    onlyDisplaySearchTips: ComponentOptions.buildBooleanOption({ defaultValue: false })\n  };\n\n  private textContainer: HTMLElement;\n  private lastKnownGoodState: any;\n\n  /**\n   * Creates a new QuerySummary component.\n   * @param element The HTMLElement on which to instantiate the component.\n   * @param options The options for the QuerySummary component.\n   * @param bindings The bindings that the component requires to function normally. If not set, these will be\n   * automatically resolved (with a slower execution time).\n   */\n  constructor(public element: HTMLElement, public options?: IQuerySummaryOptions, bindings?: IComponentBindings) {\n    super(element, QuerySummary.ID, bindings);\n\n    this.options = ComponentOptions.initComponentOptions(element, QuerySummary, options);\n    this.bind.onRootElement(QueryEvents.querySuccess, (data: IQuerySuccessEventArgs) => this.handleQuerySuccess(data));\n    this.bind.onRootElement(QueryEvents.queryError, () => this.hide());\n    this.hide();\n    this.textContainer = $$('span').el;\n    this.element.appendChild(this.textContainer);\n  }\n\n  private hide() {\n    $$(this.element).addClass('coveo-hidden');\n  }\n\n  private show() {\n    $$(this.element).removeClass('coveo-hidden');\n  }\n\n  private handleQuerySuccess(data: IQuerySuccessEventArgs) {\n    Assert.exists(data);\n    $$(this.textContainer).empty();\n    this.show();\n\n    if (!this.options.onlyDisplaySearchTips) {\n      if (data.results.results.length > 0) {\n        const first = Globalize.format(data.query.firstResult + 1, 'n0');\n        const last = Globalize.format(data.query.firstResult + data.results.results.length, 'n0');\n        const totalCount = Globalize.format(data.results.totalCountFiltered, 'n0');\n\n        const highlightFirst = $$('span', { className: 'coveo-highlight' }, first).el;\n        const highlightLast = $$('span', { className: 'coveo-highlight' }, last).el;\n        const highlightTotal = $$('span', { className: 'coveo-highlight' }, totalCount).el;\n\n        const query = data.query.q ? _.escape(data.query.q.trim()) : '';\n\n        if (query) {\n          const highlightQuery = $$('span', { className: 'coveo-highlight' }, query).el;\n\n          this.textContainer.innerHTML = l(\n            'ShowingResultsOfWithQuery',\n            highlightFirst.outerHTML,\n            highlightLast.outerHTML,\n            highlightTotal.outerHTML,\n            highlightQuery.outerHTML,\n            data.results.results.length\n          );\n        } else {\n          this.textContainer.innerHTML = l(\n            'ShowingResultsOf',\n            highlightFirst.outerHTML,\n            highlightLast.outerHTML,\n            highlightTotal.outerHTML,\n            data.results.results.length\n          );\n        }\n      }\n    }\n\n    if (data.results.exception != null && data.results.exception.code != null) {\n      const code: string = ('QueryException' + data.results.exception.code).toLocaleString();\n      this.textContainer.innerHTML = l('QueryException', code);\n    } else if (data.results.results.length == 0) {\n      this.displayInfoOnNoResults();\n    } else {\n      this.lastKnownGoodState = this.queryStateModel.getAttributes();\n    }\n  }\n\n  private displayInfoOnNoResults() {\n    const queryEscaped = _.escape(this.queryStateModel.get(QueryStateModel.attributesEnum.q));\n    let noResultsForString: Dom;\n\n    if (queryEscaped != '') {\n      noResultsForString = $$(\n        'div',\n        {\n          className: 'coveo-query-summary-no-results-string'\n        },\n        l('noResultFor', $$('span', { className: 'coveo-highlight' }, queryEscaped).el.outerHTML)\n      );\n    }\n    const cancelLastAction = $$(\n      'div',\n      {\n        className: 'coveo-query-summary-cancel-last'\n      },\n      l('CancelLastAction')\n    );\n\n    cancelLastAction.on('click', () => {\n      this.usageAnalytics.logCustomEvent<IAnalyticsNoMeta>(analyticsActionCauseList.noResultsBack, {}, this.root);\n      this.usageAnalytics.logSearchEvent<IAnalyticsNoMeta>(analyticsActionCauseList.noResultsBack, {});\n      if (this.lastKnownGoodState) {\n        this.queryStateModel.reset();\n        this.queryStateModel.setMultiple(this.lastKnownGoodState);\n        $$(this.root).trigger(QuerySummaryEvents.cancelLastAction);\n        this.queryController.executeQuery();\n      } else {\n        history.back();\n      }\n    });\n\n    const searchTipsInfo = $$('div', {\n      className: 'coveo-query-summary-search-tips-info'\n    });\n    searchTipsInfo.text(l('SearchTips'));\n    const searchTips = $$('ul');\n\n    const checkSpelling = $$('li');\n    checkSpelling.text(l('CheckSpelling'));\n\n    const fewerKeywords = $$('li');\n    fewerKeywords.text(l('TryUsingFewerKeywords'));\n\n    searchTips.el.appendChild(checkSpelling.el);\n    searchTips.el.appendChild(fewerKeywords.el);\n\n    if (this.queryStateModel.atLeastOneFacetIsActive()) {\n      const fewerFilter = $$('li');\n      fewerFilter.text(l('SelectFewerFilters'));\n      searchTips.el.appendChild(fewerFilter.el);\n    }\n\n    if (this.options.enableSearchTips) {\n      if (noResultsForString) {\n        this.textContainer.appendChild(noResultsForString.el);\n      }\n      this.textContainer.appendChild(cancelLastAction.el);\n      this.textContainer.appendChild(searchTipsInfo.el);\n      this.textContainer.appendChild(searchTips.el);\n    } else {\n      if (noResultsForString) {\n        this.textContainer.appendChild(noResultsForString.el);\n      }\n      this.textContainer.appendChild(cancelLastAction.el);\n    }\n  }\n}\nInitialization.registerAutoCreateComponent(QuerySummary);\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/QuerySummary/QuerySummary.ts","/**\n * Argument sent to all handlers bound on {@link QuerySummaryEvents.cancelLastAction}\n */\nexport interface IQuerySummaryCancelLastActionArgs {}\n\n/**\n * This static class is there to contains the different string definition for all the events related to the {@link AdvancedSearch} component.\n */\nexport class QuerySummaryEvents {\n  /**\n   * Triggered when the last action is being cancelled by the query summary component\n   *\n   * Allows external code to revert their last action.\n   * @type {string}\n   */\n  public static cancelLastAction = 'cancelLastAction';\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/events/QuerySummaryEvents.ts","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./sass/_QuerySummary.scss\n// module id = 401\n// module chunks = 35 73"],"sourceRoot":""}